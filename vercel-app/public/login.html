<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0a0a0f">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Ï∂©Îßå ERP">
  <title>Ï∂©ÎßåÏπòÌÇ® ERP - Î°úÍ∑∏Ïù∏</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700;900&family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --glass-bg: rgba(255, 255, 255, 0.06);
      --glass-border: rgba(255, 255, 255, 0.15);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      --text-white: #ffffff;
      --text-muted: rgba(255, 255, 255, 0.7);
      --gradient-btn: linear-gradient(90deg, #FF6B35 0%, #E53935 100%);
      --gradient-btn-hover: linear-gradient(90deg, #FF7F4D 0%, #EF5350 100%);
    }
    body {
      font-family: 'Outfit', 'Noto Sans KR', sans-serif;
      min-height: 100vh;
      min-height: 100dvh;
      overflow-x: hidden;
      background: #0a0a0f;
      color: var(--text-white);
      -webkit-tap-highlight-color: transparent;
    }
    /* Î∞∞Í≤Ω Î†àÏù¥Ïñ¥ */
    .login-bg {
      position: fixed;
      inset: 0;
      z-index: 0;
    }
    .login-bg-image {
      position: absolute;
      inset: 0;
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 600'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%231a1a2e'/%3E%3Cstop offset='100%25' stop-color='%230a0a0f'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23g)' width='800' height='600'/%3E%3Ccircle cx='200' cy='150' r='80' fill='%23FF6B35' opacity='0.08'/%3E%3Ccircle cx='600' cy='400' r='120' fill='%23E53935' opacity='0.06'/%3E%3C/svg%3E") no-repeat center/cover;
      filter: blur(2px);
    }
    .login-bg-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(10,10,15,0.7) 0%, rgba(10,10,15,0.95) 100%);
    }
    /* Îç∞Ïù¥ÌÑ∞ ÌîåÎ°úÏö∞ Ïï†ÎãàÎ©îÏù¥ÏÖò */
    .login-bg-lines {
      position: absolute;
      inset: 0;
      overflow: hidden;
      opacity: 0.4;
    }
    .login-bg-lines::before,
    .login-bg-lines::after {
      content: '';
      position: absolute;
      left: -100%;
      width: 200%;
      height: 2px;
      background: linear-gradient(90deg, transparent, #FF6B35, #E53935, transparent);
      animation: flowLine 8s linear infinite;
    }
    .login-bg-lines::before { top: 20%; animation-delay: 0s; opacity: 0.6; }
    .login-bg-lines::after { top: 60%; animation-delay: -4s; opacity: 0.4; }
    @keyframes flowLine {
      0% { transform: translateX(0); }
      100% { transform: translateX(50%); }
    }
    /* Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà */
    #login-screen {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      min-height: 100dvh;
      padding: 24px;
      transition: opacity 0.4s ease;
    }
    #login-screen.login-exit { opacity: 0; }
    /* Î°úÍ≥† & ÌÉÄÏù¥ÌãÄ */
    .login-brand {
      text-align: center;
      margin-bottom: 32px;
    }
    .login-logo-wrap {
      margin-bottom: 16px;
    }
    .login-logo {
      max-width: 180px;
      width: 70%;
      height: auto;
      filter: drop-shadow(0 4px 12px rgba(255, 107, 53, 0.3));
    }
    .login-title {
      font-size: clamp(22px, 5vw, 28px);
      font-weight: 900;
      letter-spacing: 0.12em;
      color: var(--text-white);
      margin-bottom: 4px;
    }
    .login-subtitle {
      font-size: 14px;
      font-weight: 400;
      font-style: italic;
      color: var(--text-muted);
      letter-spacing: 0.08em;
    }
    /* Í∏ÄÎûòÏä§Î™®ÌîºÏ¶ò Ïπ¥Îìú */
    .login-card {
      width: 100%;
      max-width: 400px;
      padding: 36px 28px;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      box-shadow: var(--glass-shadow), 0 0 40px rgba(255, 107, 53, 0.08);
      transition: box-shadow 0.3s ease;
    }
    .login-card:hover {
      box-shadow: var(--glass-shadow), 0 0 60px rgba(255, 107, 53, 0.12);
    }
    /* ÏûÖÎ†• ÌïÑÎìú */
    .login-input {
      width: 100%;
      min-height: 52px;
      padding: 14px 20px;
      margin-bottom: 14px;
      font-size: 15px;
      font-family: inherit;
      color: var(--text-white);
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      box-sizing: border-box;
      transition: border-color 0.2s, box-shadow 0.2s;
      -webkit-appearance: none;
      appearance: none;
    }
    .login-input::placeholder { color: var(--text-muted); }
    .login-input:focus {
      outline: none;
      border-color: rgba(255, 107, 53, 0.6);
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.15);
    }
    select.login-input {
      cursor: pointer;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23ffffff' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 18px center;
      padding-right: 44px;
    }
    .login-input option {
      background: #1a1a2e;
      color: var(--text-white);
    }
    @media (max-width: 480px) {
      .login-input { min-height: 56px; padding: 16px 20px; }
    }
    /* Î°úÍ∑∏Ïù∏ Î≤ÑÌäº */
    .login-btn {
      width: 100%;
      min-height: 54px;
      padding: 18px;
      margin-top: 20px;
      font-size: 17px;
      font-weight: 700;
      font-family: inherit;
      letter-spacing: 0.08em;
      color: white;
      background: var(--gradient-btn);
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(229, 57, 53, 0.35);
      transition: all 0.2s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .login-btn:hover {
      background: var(--gradient-btn-hover);
      box-shadow: 0 6px 24px rgba(229, 57, 53, 0.45);
      transform: translateY(-1px);
    }
    .login-btn:active { transform: translateY(0); }
    .login-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }
    /* Ìë∏ÌÑ∞ */
    .login-footer {
      margin-top: 28px;
      text-align: center;
      font-size: 12px;
      color: var(--text-muted);
    }
    /* Î°úÎî© */
    #loading {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(10, 10, 15, 0.9);
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    #loading.show { display: flex; }
    #loading .spinner-border {
      color: #FF6B35 !important;
      width: 3rem;
      height: 3rem;
    }
  </style>
</head>
<body>
  <div id="loading" class="show">
    <div class="spinner-border" role="status"></div>
  </div>

  <div class="login-bg">
    <div class="login-bg-image"></div>
    <div class="login-bg-overlay"></div>
    <div class="login-bg-lines"></div>
  </div>

  <div id="login-screen">
    <div class="login-brand">
      <div class="login-logo-wrap">
        <img src="/public/img/logo.png" alt="Choongman Chicken" class="login-logo">
      </div>
      <h1 class="login-title">CHUNGMAN CHICKEN</h1>
      <p class="login-subtitle">Integrated ERP</p>
    </div>

    <div class="login-card">
      <select id="langSelect" class="login-input" onchange="changeLanguage()">
        <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
        <option value="en">üá∫üá∏ English</option>
        <option value="th">üáπüá≠ ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option>
        <option value="mm">üá≤üá≤ ·Äô·Äº·Äî·Ä∫·Äô·Ä¨</option>
        <option value="la">üá±üá¶ ‡∫û‡∫≤‡∫™‡∫≤‡∫•‡∫≤‡∫ß</option>
      </select>
      <select id="storeSelect" class="login-input" onchange="onStoreChange()">
        <option value="">Îß§Ïû• ÏÑ†ÌÉù...</option>
      </select>
      <select id="loginName" class="login-input">
        <option value="">Ïù¥Î¶Ñ ÏÑ†ÌÉù...</option>
      </select>
      <input type="password" id="loginPw" class="login-input" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ (PIN)" autocomplete="off">
      <button class="login-btn" id="btn-login" onclick="tryLogin()">Î°úÍ∑∏Ïù∏</button>
      <p class="login-footer">Powered by Supabase & Vercel</p>
    </div>
  </div>

  <script src="/public/api-adapter.js"></script>
  <script>
    var loginData = {};
    var currentLang = (typeof sessionStorage !== 'undefined' && sessionStorage.getItem('cm_lang')) || 'ko';

    var I18N = {
      ko: { m_select_store: "Îß§Ïû• ÏÑ†ÌÉù", m_select_name: "Ïù¥Î¶Ñ ÏÑ†ÌÉù", m_pin_ph: "ÎπÑÎ∞ÄÎ≤àÌò∏ (PIN)", btn_login: "Î°úÍ∑∏Ïù∏", err_select_store_name: "Îß§Ïû•Í≥º Ïù¥Î¶ÑÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.", err_login_fail: "Î°úÍ∑∏Ïù∏ Ïã§Ìå®: PINÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.", err_server: "ÏÑúÎ≤Ñ Ïò§Î•ò" },
      en: { m_select_store: "Select Store", m_select_name: "Select Name", m_pin_ph: "Password (PIN)", btn_login: "Login", err_select_store_name: "Please select store and name.", err_login_fail: "Login failed: Check PIN.", err_server: "Server error" },
      th: { m_select_store: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤", m_select_name: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠", m_pin_ph: "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (PIN)", btn_login: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö", err_select_store_name: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠", err_login_fail: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", err_server: "‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå" },
      mm: { m_select_store: "·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´", m_select_name: "·Ä°·Äô·Ää·Ä∫·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´", m_pin_ph: "·Äú·Äª·Äæ·Ä≠·ÄØ·Ä∑·Äù·Äæ·ÄÄ·Ä∫·Äî·Ä∂·Äï·Ä´·Äê·Ä∫ (PIN)", btn_login: "·Äù·ÄÑ·Ä∫·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Ää·Ä∫", err_select_store_name: "·ÄÜ·Ä≠·ÄØ·ÄÑ·Ä∫·Äî·Äæ·ÄÑ·Ä∑·Ä∫·Ä°·Äô·Ää·Ä∫·Äõ·ÄΩ·Ä±·Ä∏·Äï·Ä´", err_login_fail: "·Äù·ÄÑ·Ä∫·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´", err_server: "·ÄÜ·Ä¨·Äó·Ä¨ ·Ä°·Äô·Äæ·Ä¨·Ä∏" },
      la: { m_select_store: "‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫™‡∫≤‡∫Ç‡∫≤", m_select_name: "‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫ä‡∫∑‡ªà", m_pin_ph: "‡∫•‡∫∞‡∫´‡∫±‡∫î (PIN)", btn_login: "‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫™‡∫π‡ªà‡∫•‡∫∞‡∫ö‡∫ª‡∫ö", err_select_store_name: "‡ªÄ‡∫•‡∫∑‡∫≠‡∫Å‡∫™‡∫≤‡∫Ç‡∫≤‡ªÅ‡∫•‡∫∞‡∫ä‡∫∑‡ªà", err_login_fail: "‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫ö‡ªç‡ªà‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î", err_server: "‡∫Ç‡ªç‡ªâ‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î‡ªÄ‡∫ä‡∫µ‡∫ö‡ªÄ‡∫ß‡∫µ" }
    };

    function t(key) {
      var L = I18N[currentLang];
      return (L && L[key]) ? L[key] : (I18N.ko && I18N.ko[key]) ? I18N.ko[key] : key;
    }

    function changeLanguage() {
      var sel = document.getElementById('langSelect');
      if (sel) {
        currentLang = sel.value || 'ko';
        try { sessionStorage.setItem('cm_lang', currentLang); } catch (e) {}
        applyTranslations();
      }
    }

    function applyTranslations() {
      var s = document.getElementById('storeSelect');
      var n = document.getElementById('loginName');
      var pw = document.getElementById('loginPw');
      var btn = document.getElementById('btn-login');
      if (s && s.options[0]) s.options[0].text = t('m_select_store') + '...';
      if (n && n.options[0]) n.options[0].text = t('m_select_name') + '...';
      if (pw) pw.placeholder = t('m_pin_ph');
      if (btn) btn.textContent = t('btn_login');
    }

    function load(show) {
      var el = document.getElementById('loading');
      if (el) el.classList.toggle('show', !!show);
    }

    function fillStoreSelect() {
      var s = document.getElementById('storeSelect');
      if (!s || !loginData) return;
      s.innerHTML = '<option value="">' + t('m_select_store') + '...</option>';
      for (var k in loginData) {
        if (loginData.hasOwnProperty(k)) s.add(new Option(k, k));
      }
    }

    function onStoreChange() {
      var store = document.getElementById('storeSelect').value;
      var n = document.getElementById('loginName');
      if (!n) return;
      n.innerHTML = '<option value="">' + t('m_select_name') + '...</option>';
      if (loginData[store]) {
        loginData[store].forEach(function(name) { n.add(new Option(name, name)); });
      }
    }

    function tryLogin() {
      var s = document.getElementById('storeSelect').value;
      var n = document.getElementById('loginName').value;
      var p = document.getElementById('loginPw').value;
      if (!s || !n) {
        alert(t('err_select_store_name'));
        return;
      }
      var btn = document.getElementById('btn-login');
      if (btn) btn.disabled = true;

      window.runApi('POST', 'loginCheck', { store: s, name: n, pw: p, isAdminPage: false })
        .then(function(res) {
          if (btn) btn.disabled = false;
          if (res && res.success) {
            try {
              sessionStorage.setItem('cm_store', res.storeName || s);
              sessionStorage.setItem('cm_user', res.userName || n);
              sessionStorage.setItem('cm_role', res.role || '');
            } catch (e) {}
            window.location.href = '/app';
          } else {
            alert(t('err_login_fail'));
          }
        })
        .catch(function(err) {
          if (btn) btn.disabled = false;
          alert(t('err_server') + ': ' + (err && err.message ? err.message : err));
        });
    }

    load(true);
    var langSel = document.getElementById('langSelect');
    if (langSel && currentLang) langSel.value = currentLang;
    window.runApi('GET', 'getLoginData', {})
      .then(function(d) {
        load(false);
        loginData = (d && d.users) ? d.users : (d || {});
        fillStoreSelect();
        applyTranslations();
      })
      .catch(function(err) {
        load(false);
        alert(t('err_server') + ': ' + (err && err.message ? err.message : err));
      });
  </script>
</body>
</html>
